name: Generate language statistics

on:
  schedule:
    # Runs nightly at midnight (UTC)
    - cron: '0 0 * * *'
  workflow_dispatch: # Allow manual runs

permissions:
  contents: write  # allow the workflow to push commits

jobs:
  update-stats:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Generate language stats images
        env:
          USERNAME: "benkake"
          STATS_TOKEN: ${{ secrets.STATS_TOKEN }}
          THEME: github
        run: |
  mkdir -p .github
  echo "Downloading public stats..."
  curl -f -sSL "https://github-readme-stats.vercel.app/api/top-langs/?username=${USERNAME}&layout=compact&theme=${THEME}" \
    -o .github/top-langs-public.svg || echo "Public stats failed"

  if [ -n "${STATS_TOKEN:-}" ]; then
    echo "Downloading private stats..."
    curl -f -sSL \
      -H "Authorization: token ${STATS_TOKEN}" \
      "https://github-readme-stats.vercel.app/api/top-langs/?username=${USERNAME}&layout=compact&theme=${THEME}&count_private=true" \
      -o .github/top-langs-private.svg || echo "Private stats failed"
  fi
